<div class="container product-show">
	<div class="col-md-offset-2 col-md-8">
		<br>
		<h1>商品詳細</h1>
		<br>
		<!-- 商品の概要説明 -->
		<div class="row">
			<div class="overview clearfix">
				<div class="product_image pull-left col-md-6">
					<% if @product.jacket_image_id.present? %>
						<%= attachment_image_tag @product, :jacket_image, :fill, 350, 350, class:"border" %>
					<% else %>
						<%= image_tag 'no_image.jpg', size: '350x350', class:"border" %>
					<% end %>
				</div>
				<div class="product_details pull-right col-md-6">
					<div class="panel panel-default">
						<div class="panel-heading">
							商品詳細
						</div>
						<table class="table">
							<thead></thead>
							<tbody>
								<tr>
									<td>アーティスト：<%= @artist.name %></td>
								</tr>
								<tr>
									<td>レーベル：<%= @label.label %></td>
								</tr>
								<tr>
									<td>ジャンル：<%= @genre.genre %></td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="panel panel-success">
						<div class="panel-heading">
							商品説明
						</div>
						<div class="panel-body">
							<%= @product.description %>
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- 商品ステータス・ -->
		<div class="row">
			<div class="product_status clearfix">
				<p class="stock col-md-2 pull-left" style="margin-top: 10px;">
					在庫：<%= @product.stock %>
				</p>
				<p class="price col-md-2 pull-left" style="margin-top: 10px;">
					<% tax_included = @product.price*1.08 %>
					価格：<%= tax_included.to_i %>（税込）
				</p>
				<p class="count col-md-2 pull-left">
					<%= form_for @cart do |f| %>
					個数:
					<%= f.number_field :product_count %>
				</p>


			<!-- いいね機能 -->
				<% if current_user.present? %>
					<% if @product.likes?(current_user) %>
						<li>
							<%= link_to product_like_path(@product), method: :delete do %>
							<div class="like-box-of animated bounce">
								<i class="fa fa-heart" aria-hidden="true" style="color: red;"></i>
							</div>
								<%= @product.likes.count %> いいね
							<% end %>
						</li>
							<% else %>
						<li>
							<%= link_to  product_likes_path(@product), method: :post do %>
							<div class="like-box animated bounceOut">
								<i class="fa fa-heart" aria-hidden="true" style="color: pink;"></i>
							</div>
							<%= @product.likes.count %> いいね
							<% end %>
						</li>
					<% end %>

				<% else %>
					<%= @product.likes.count %> いいね
				<% end %>
			<!-- いいね -->

			</div>
		</div>

		<div class="row" style="margin-top: 20px; margin-bottom: 20px;">
			<div>
				<!-- カートに商品情報およびユーザーIDをhidden fieldで送る -->
				<%= f.hidden_field :product_id, value: @product.id %>
				<%= f.hidden_field :product_price, value: @product.price %>
				<%= f.submit "カートに追加する" %>
				<% end %>
			</div>
		</div>



		<!-- レビュー --><!--レビュー機能はトラが作ります-->
		<div class="row review-container">
			<% if user_signed_in? %>
				<div class="col-md-5">
						<h3>レビュー投稿</h3>
						<!-- コメント入力欄を商品の詳細ページに表示するためのrender -->
						<%= render partial: 'reviews/form', locals: { reviews: @reviews, products: @products }%>
				</div>
				<h3>レビュー一覧</h3>
				<div class="col-md-7 scroller">
					<div id="reviews_area"><!--ここのidを目印にdiv内をAjaxで書き換え-->
						<!-- 投稿されたコメント一覧を商品の詳細ページに表示するためのrender -->
						<%= render partial: 'reviews/index', locals: { reviews: @reviews }%>
					</div>
				</div>
			<% else %>
				<h3>レビュー一覧</h3>
				<div class="col-md-6 col-md-offset-3 scroller">
					<div id="reviews_area">
						<%= render partial: 'reviews/index', locals: { reviews: @reviews } %>
					</div>
				</div>
			<% end %>
		</div>


		<!-- 収録曲 -->
		<div class="panel panel-default">
			<% @disks.each.with_index(1) do |disk, d|%>
				<div class="panel-heading">
					収録曲 - disc<%= d %>
				</div>
				<table class="table songs-table">
					<% songs = Song.where(disk_id: disk.id) %>
					<% songs.each.with_index(1) do |song, s| %>
						<tbody>
							<tr class="row">
								<td class="song-index col-md-2"><%= s %></td>
						        <td class="song-name col-md-8"><%= song.song %></td>
						        <td class="song-length col-md-2"><%= song.second %></td>
							</tr>
						</tbody>
					<% end %>
				</table>
			<% end %>
		</div>
	</div>
</div>
